import { Component, Input, ViewChild, EventEmitter, Output } from '@angular/core';
import { MultiSelect } from 'primeng/multiselect';
import isEqual from 'lodash.isequal';
import { MODE } from '../constants';
import { ProvenanceWidgetsService } from '../provenance-widgets.service';
import * as i0 from "@angular/core";
import * as i1 from "../provenance-widgets.service";
import * as i2 from "primeng/api";
import * as i3 from "@angular/common";
import * as i4 from "@angular-slider/ngx-slider";
import * as i5 from "primeng/button";
import * as i6 from "@angular/forms";
import * as i7 from "primeng/multiselect";
import * as i8 from "../icon/icon.component";
export class MultiselectComponent extends MultiSelect {
    get selected() {
        return this._selected;
    }
    set selected(value) {
        if (!this.firstChange && !isEqual(this._selected, value)) {
            this.handleChange(value || []);
        }
        this.firstChange = false;
        this._selected = value;
    }
    get provenance() {
        return this._provenance;
    }
    set provenance(value) {
        if (this._provenance && value?.revalidate) {
            this._provenance = value;
            this.ngOnInit();
            this._visualize();
        }
        this._provenance = value;
    }
    constructor(mss, el, renderer, cd, zone, filterService, config, overlayService) {
        super(el, renderer, cd, zone, filterService, config, overlayService);
        this.mss = mss;
        this.firstChange = true;
        this.mode = MODE;
        this.selectedChange = new EventEmitter();
        this.visualize = true;
        this.freeze = false;
        this.interval = NaN;
        this.optionsRecord = {};
        this.myOverlayOptions = { 'appendTo': 'body', ...this.overlayOptions };
        this.provenanceChange = new EventEmitter();
        mss.init(el, ".panel" + this.mss.myId + " > div > ul", "multiselect");
        mss.crosshairSelect = (keys) => {
            this.selectedChange.emit(keys.map((key) => this.optionsRecord[key]));
        };
    }
    getId() {
        return this.mss.myId;
    }
    ngOnInit() {
        super.ngOnInit();
        this.mss.options = this.options.length;
        this.mss.mode = this.mode;
        this.options.forEach((option) => {
            this.optionsRecord[option[this.dataKey]] = option;
        });
        if (this.provenance?.hasUserInteracted || this.provenance?.revalidate) {
            this.mss.setProvenance(this.provenance);
            this.selected = Object
                .entries(this.mss.getProvenance().dataByOption)
                .filter(([_, v]) => {
                const last = v.at(-1);
                return last && last.unselect === undefined && last.select !== undefined;
            })
                .map(([k, _]) => this.optionsRecord[k]);
            return;
        }
        if (this.selected) {
            this.mss.addSimultaneousEvents([], this.selected.map(o => o[this.dataKey]), this.freeze, false);
        }
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.mss.setElement(this.el);
        if (this.mss.getProvenance()?.hasUserInteracted)
            this._visualize();
    }
    ngOnDestroy() {
        clearInterval(this.interval);
    }
    handleHide(e) {
        this.onPanelHide?.emit(e);
        this.overlayVisible = false;
    }
    handleShow(e) {
        this.onPanelShow?.emit(e);
        this.overlayVisible = true;
        this._visualize();
    }
    handleChange(value) {
        this.mss.addSimultaneousEvents(this.selected ? this.selected.map(o => o[this.dataKey]) : [], value.map(o => o[this.dataKey]), this.freeze, true, new Date(), this.provenanceChange, this._visualize.bind(this));
    }
    _visualize() {
        if (!this.visualize || !this.overlayVisible)
            return;
        let li = undefined;
        for (const option of this.options) {
            const div = document.getElementById(this.mss.myId + option[this.dataKey] + 'div');
            if (div && div.parentElement) {
                li = div.parentElement;
                break;
            }
        }
        if (!li)
            return;
        // subtracting padding values
        // TODO: remove magic numbers
        const offsetWidth = li.offsetWidth - 40 - 22; //checkbox width
        const offsetHeight = li.offsetHeight - 24;
        this.mss.visualize(this.mode, offsetWidth, offsetHeight);
    }
    getOption(key) {
        const events = this.mss.dataByOption[key]?.length;
        return events ? `(${events})` : "";
    }
    getProvenance() {
        return this.mss;
    }
    handleClick(btn) {
        this.mss.toggleProvenanceMode(btn, false);
        setTimeout(() => this.pMultiSelect.show(), this.pMultiSelect.overlayVisible ? 1000 : 0);
    }
    handleFilter(event) {
        this.onFilter?.emit(event);
        // When the filter is cleared, items are not made available to the DOM immediately, so we need to wait a bit
        // TODO: find a better way to handle this
        const timeout = event.filter ? 0 : 100;
        setTimeout(() => this._visualize(), timeout);
    }
}
MultiselectComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: MultiselectComponent, deps: [{ token: i1.ProvenanceWidgetsService }, { token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i0.ChangeDetectorRef }, { token: i0.NgZone }, { token: i2.FilterService }, { token: i2.PrimeNGConfig }, { token: i2.OverlayService }], target: i0.ɵɵFactoryTarget.Component });
MultiselectComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: MultiselectComponent, selector: "provenance-multiselect", inputs: { mode: "mode", selected: "selected", iconSize: "iconSize", visualize: "visualize", freeze: "freeze", provenance: "provenance" }, outputs: { selectedChange: "selectedChange", provenanceChange: "provenanceChange" }, providers: [ProvenanceWidgetsService], viewQueries: [{ propertyName: "pMultiSelect", first: true, predicate: ["pMultiSelect"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<div class=\"p-inputgroup flex flex-row gap-3\">\n    <button\n    *ngIf=\"visualize\"\n    pButton\n    type=\"button\"\n    class=\"p-button-help p-button-text\"\n    [disabled]=\"!getProvenance().hasUserInteracted\"\n    [ngStyle]=\"{ 'padding': 0, 'align-self': 'center', 'height': 'min-content', 'visibility': visualize ? 'visible' : 'hidden'}\"\n    #btn\n    (click)=\"handleClick(btn)\"\n   >\n    <provenance-icon \n    [icon]=\"!getProvenance().hasUserInteracted ? 'disabled' : getProvenance().provenanceMode\"\n    [size]=\"iconSize\"\n    ></provenance-icon>\n   </button>\n   <p-multiSelect\n    #pMultiSelect \n    [appendTo]=\"appendTo\" \n    [ariaFilterLabel]=\"ariaFilterLabel\" \n    [label]=\"label\"\n    [ariaLabelledBy]=\"ariaLabelledBy\"\n    [autofocusFilter]=\"autofocusFilter\"\n    [autoZIndex]=\"autoZIndex\"\n    [baseZIndex]=\"baseZIndex\"\n    [defaultLabel]=\"defaultLabel\"\n    [dataKey]=\"dataKey\"\n    [disabled]=\"disabled\"\n    [displaySelectedLabel]=\"displaySelectedLabel\"\n    [dropdownIcon]=\"dropdownIcon\"\n    [emptyFilterMessage]=\"emptyFilterMessage\"\n    [filter]=\"filter\"\n    [filterMatchMode]=\"filterMatchMode\"\n    [filterValue]=\"filterValue\"\n    [filterLocale]=\"filterLocale\"\n    [filterBy]=\"filterBy\"\n    [filterPlaceHolder]=\"filterPlaceHolder\"\n    [hideTransitionOptions]=\"hideTransitionOptions\"\n    [inputId]=\"inputId\"\n    [maxSelectedLabels]=\"maxSelectedLabels || 3\"\n    [name]=\"name\"\n    [options]=\"options\"\n    [optionLabel]=\"optionLabel\"\n    [optionValue]=\"optionValue\"\n    [optionDisabled]=\"optionDisabled\"\n    [optionGroupLabel]=\"optionGroupLabel\"\n    [optionGroupChildren]=\"optionGroupChildren\"\n    [group]=\"group\"\n    [overlayVisible]=\"overlayVisible\"\n    [panelStyle]=\"panelStyle\"\n    [placeholder]=\"placeholder\"\n    [readonly]=\"readonly\"\n    [emptyMessage]=\"emptyMessage\"\n    [emptyFilterMessage]=\"emptyFilterMessage\"\n    [resetFilterOnHide]=\"resetFilterOnHide\"\n    [scrollHeight]=\"scrollHeight\"\n    [selectedItemsLabel]=\"selectedItemsLabel\"\n    [selectionLimit]=\"selectionLimit\"\n    [showHeader]=\"showHeader\"\n    [showTransitionOptions]=\"showTransitionOptions\"\n    [showToggleAll]=\"showToggleAll\"\n    [style]=\"style\"\n    [styleClass]=\"(styleClass || '') + ' provenance-multiselect'\"\n    [panelStyleClass]=\"(panelStyleClass || '') + 'provenance-multiselect-panel panel' + this.getId()\"\n    [tabindex]=\"tabindex\"\n    [tooltip]=\"tooltip\"\n    [tooltipStyleClass]=\"tooltipStyleClass\"\n    [tooltipPosition]=\"tooltipPosition\"\n    [tooltipPositionStyle]=\"tooltipPositionStyle\"\n    [showClear]=\"showClear\"\n    [virtualScroll]=\"virtualScroll\"\n    [virtualScrollItemSize]=\"virtualScrollItemSize\"\n    [virtualScrollOptions]=\"virtualScrollOptions\"\n    [overlayOptions]=\"myOverlayOptions\"\n    [lazy]=\"lazy\"\n    (onClick)=\"onClick\"\n    (onChange)=\"onChange\"\n    (onFilter)=\"handleFilter($event)\"\n    (onFocus)=\"onFocus\"\n    (onBlur)=\"onBlur\"\n    (onPanelShow)=\"handleShow($event)\"\n    (onPanelHide)=\"handleHide($event)\"\n    (onClear)=\"onClear\"\n    (onLazyLoad)=\"onLazyLoad\"\n    (onRemove)=\"onRemove\"\n    (ngModelChange)=\"this.getProvenance().interaction = 'user-change'; selectedChange.emit($event)\"\n    [ngModel]=\"selected\"\n    >\n      <ng-template let-option pTemplate=\"item\">\n        <div style=\"position: relative; width: 100%;\" [id]=\"getId() + option[dataKey] + 'div'\">\n          <svg \n            [id]=\"getId() + option[dataKey]\" \n            width=\"0\" \n            height=\"0\"\n            [style]=\"{ 'position': 'absolute', 'display': getProvenance().hasUserInteracted ? 'initial' : 'none' }\"\n          ></svg>\n          <div style=\"display: flex; justify-content: space-between; position: inherit;\">\n            <span>\n              {{ option[optionLabel] }}\n            </span>\n          </div>\n        </div>\n      </ng-template>\n      <ng-template pTemplate=\"footer\">\n        <div class=\"custom-slider temporal-slider\">\n          <ngx-slider\n            *ngIf=\"getProvenance().provenanceMode === 'temporal'\"\n            [value]=\"getProvenance().temporalFilterRange[0]\"\n            [highValue]=\"getProvenance().temporalFilterRange[1]\"\n            [options]=\"getProvenance().temporalOptions\"\n            (userChangeEnd)=\"getProvenance().setTemporalRange($event)\"\n          >\n          </ngx-slider>\n        </div>\n      </ng-template>\n    </p-multiSelect>\n  \n   </div>", styles: ["::ng-deep div.provenance-multiselect-panel>div>ul{position:relative}::ng-deep div.provenance-multiselect-panel>div.p-multiselect-footer.ng-star-inserted:has(div.temporal-slider){padding-left:48px;padding-right:24px}::ng-deep div.provenance-multiselect-panel>div.p-multiselect-items-wrapper>ul>p-multiselectitem>li.p-multiselect-item{background:none!important}::ng-deep div.provenance-multiselect{width:initial!important}\n", "::ng-deep .custom-slider .ngx-slider .ngx-slider-bar{background:lightgray;height:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-selection{background:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer{width:8px;height:16px;top:auto;bottom:0;background-color:#333;border-top-left-radius:3px;border-top-right-radius:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer:after{display:none}::ng-deep .custom-slider:not(.temporal-slider) .ngx-slider .ngx-slider-bubble{top:5px}::ng-deep .custom-slider .ngx-slider .ngx-slider-limit{font-weight:700;color:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick{width:1px;height:10px;margin-left:4px;border-radius:0;background:#ffe4d1;top:-1px}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick.ngx-slider-selected{background:var(--blue-500)}::ng-deep g.axis text{font-size:.7rem}::ng-deep .custom-slider span{margin-top:0!important;padding-top:0!important}\n"], dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: i4.SliderComponent, selector: "ngx-slider", inputs: ["value", "highValue", "options", "manualRefresh", "triggerFocus"], outputs: ["valueChange", "highValueChange", "userChangeStart", "userChange", "userChangeEnd"] }, { kind: "directive", type: i2.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "directive", type: i5.ButtonDirective, selector: "[pButton]", inputs: ["iconPos", "loadingIcon", "label", "icon", "loading"] }, { kind: "directive", type: i6.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i6.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i7.MultiSelect, selector: "p-multiSelect", inputs: ["style", "styleClass", "panelStyle", "panelStyleClass", "inputId", "disabled", "readonly", "group", "filter", "filterPlaceHolder", "filterLocale", "overlayVisible", "tabindex", "appendTo", "dataKey", "name", "label", "ariaLabelledBy", "displaySelectedLabel", "maxSelectedLabels", "selectionLimit", "selectedItemsLabel", "showToggleAll", "emptyFilterMessage", "emptyMessage", "resetFilterOnHide", "dropdownIcon", "optionLabel", "optionValue", "optionDisabled", "optionGroupLabel", "optionGroupChildren", "showHeader", "filterBy", "scrollHeight", "lazy", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "overlayOptions", "ariaFilterLabel", "filterMatchMode", "tooltip", "tooltipPosition", "tooltipPositionStyle", "tooltipStyleClass", "autofocusFilter", "display", "autocomplete", "showClear", "autoZIndex", "baseZIndex", "showTransitionOptions", "hideTransitionOptions", "defaultLabel", "placeholder", "options", "filterValue", "itemSize"], outputs: ["onChange", "onFilter", "onFocus", "onBlur", "onClick", "onClear", "onPanelShow", "onPanelHide", "onLazyLoad", "onRemove"] }, { kind: "component", type: i8.IconComponent, selector: "provenance-icon", inputs: ["icon", "size"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: MultiselectComponent, decorators: [{
            type: Component,
            args: [{ selector: 'provenance-multiselect', providers: [ProvenanceWidgetsService], template: "<div class=\"p-inputgroup flex flex-row gap-3\">\n    <button\n    *ngIf=\"visualize\"\n    pButton\n    type=\"button\"\n    class=\"p-button-help p-button-text\"\n    [disabled]=\"!getProvenance().hasUserInteracted\"\n    [ngStyle]=\"{ 'padding': 0, 'align-self': 'center', 'height': 'min-content', 'visibility': visualize ? 'visible' : 'hidden'}\"\n    #btn\n    (click)=\"handleClick(btn)\"\n   >\n    <provenance-icon \n    [icon]=\"!getProvenance().hasUserInteracted ? 'disabled' : getProvenance().provenanceMode\"\n    [size]=\"iconSize\"\n    ></provenance-icon>\n   </button>\n   <p-multiSelect\n    #pMultiSelect \n    [appendTo]=\"appendTo\" \n    [ariaFilterLabel]=\"ariaFilterLabel\" \n    [label]=\"label\"\n    [ariaLabelledBy]=\"ariaLabelledBy\"\n    [autofocusFilter]=\"autofocusFilter\"\n    [autoZIndex]=\"autoZIndex\"\n    [baseZIndex]=\"baseZIndex\"\n    [defaultLabel]=\"defaultLabel\"\n    [dataKey]=\"dataKey\"\n    [disabled]=\"disabled\"\n    [displaySelectedLabel]=\"displaySelectedLabel\"\n    [dropdownIcon]=\"dropdownIcon\"\n    [emptyFilterMessage]=\"emptyFilterMessage\"\n    [filter]=\"filter\"\n    [filterMatchMode]=\"filterMatchMode\"\n    [filterValue]=\"filterValue\"\n    [filterLocale]=\"filterLocale\"\n    [filterBy]=\"filterBy\"\n    [filterPlaceHolder]=\"filterPlaceHolder\"\n    [hideTransitionOptions]=\"hideTransitionOptions\"\n    [inputId]=\"inputId\"\n    [maxSelectedLabels]=\"maxSelectedLabels || 3\"\n    [name]=\"name\"\n    [options]=\"options\"\n    [optionLabel]=\"optionLabel\"\n    [optionValue]=\"optionValue\"\n    [optionDisabled]=\"optionDisabled\"\n    [optionGroupLabel]=\"optionGroupLabel\"\n    [optionGroupChildren]=\"optionGroupChildren\"\n    [group]=\"group\"\n    [overlayVisible]=\"overlayVisible\"\n    [panelStyle]=\"panelStyle\"\n    [placeholder]=\"placeholder\"\n    [readonly]=\"readonly\"\n    [emptyMessage]=\"emptyMessage\"\n    [emptyFilterMessage]=\"emptyFilterMessage\"\n    [resetFilterOnHide]=\"resetFilterOnHide\"\n    [scrollHeight]=\"scrollHeight\"\n    [selectedItemsLabel]=\"selectedItemsLabel\"\n    [selectionLimit]=\"selectionLimit\"\n    [showHeader]=\"showHeader\"\n    [showTransitionOptions]=\"showTransitionOptions\"\n    [showToggleAll]=\"showToggleAll\"\n    [style]=\"style\"\n    [styleClass]=\"(styleClass || '') + ' provenance-multiselect'\"\n    [panelStyleClass]=\"(panelStyleClass || '') + 'provenance-multiselect-panel panel' + this.getId()\"\n    [tabindex]=\"tabindex\"\n    [tooltip]=\"tooltip\"\n    [tooltipStyleClass]=\"tooltipStyleClass\"\n    [tooltipPosition]=\"tooltipPosition\"\n    [tooltipPositionStyle]=\"tooltipPositionStyle\"\n    [showClear]=\"showClear\"\n    [virtualScroll]=\"virtualScroll\"\n    [virtualScrollItemSize]=\"virtualScrollItemSize\"\n    [virtualScrollOptions]=\"virtualScrollOptions\"\n    [overlayOptions]=\"myOverlayOptions\"\n    [lazy]=\"lazy\"\n    (onClick)=\"onClick\"\n    (onChange)=\"onChange\"\n    (onFilter)=\"handleFilter($event)\"\n    (onFocus)=\"onFocus\"\n    (onBlur)=\"onBlur\"\n    (onPanelShow)=\"handleShow($event)\"\n    (onPanelHide)=\"handleHide($event)\"\n    (onClear)=\"onClear\"\n    (onLazyLoad)=\"onLazyLoad\"\n    (onRemove)=\"onRemove\"\n    (ngModelChange)=\"this.getProvenance().interaction = 'user-change'; selectedChange.emit($event)\"\n    [ngModel]=\"selected\"\n    >\n      <ng-template let-option pTemplate=\"item\">\n        <div style=\"position: relative; width: 100%;\" [id]=\"getId() + option[dataKey] + 'div'\">\n          <svg \n            [id]=\"getId() + option[dataKey]\" \n            width=\"0\" \n            height=\"0\"\n            [style]=\"{ 'position': 'absolute', 'display': getProvenance().hasUserInteracted ? 'initial' : 'none' }\"\n          ></svg>\n          <div style=\"display: flex; justify-content: space-between; position: inherit;\">\n            <span>\n              {{ option[optionLabel] }}\n            </span>\n          </div>\n        </div>\n      </ng-template>\n      <ng-template pTemplate=\"footer\">\n        <div class=\"custom-slider temporal-slider\">\n          <ngx-slider\n            *ngIf=\"getProvenance().provenanceMode === 'temporal'\"\n            [value]=\"getProvenance().temporalFilterRange[0]\"\n            [highValue]=\"getProvenance().temporalFilterRange[1]\"\n            [options]=\"getProvenance().temporalOptions\"\n            (userChangeEnd)=\"getProvenance().setTemporalRange($event)\"\n          >\n          </ngx-slider>\n        </div>\n      </ng-template>\n    </p-multiSelect>\n  \n   </div>", styles: ["::ng-deep div.provenance-multiselect-panel>div>ul{position:relative}::ng-deep div.provenance-multiselect-panel>div.p-multiselect-footer.ng-star-inserted:has(div.temporal-slider){padding-left:48px;padding-right:24px}::ng-deep div.provenance-multiselect-panel>div.p-multiselect-items-wrapper>ul>p-multiselectitem>li.p-multiselect-item{background:none!important}::ng-deep div.provenance-multiselect{width:initial!important}\n", "::ng-deep .custom-slider .ngx-slider .ngx-slider-bar{background:lightgray;height:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-selection{background:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer{width:8px;height:16px;top:auto;bottom:0;background-color:#333;border-top-left-radius:3px;border-top-right-radius:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer:after{display:none}::ng-deep .custom-slider:not(.temporal-slider) .ngx-slider .ngx-slider-bubble{top:5px}::ng-deep .custom-slider .ngx-slider .ngx-slider-limit{font-weight:700;color:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick{width:1px;height:10px;margin-left:4px;border-radius:0;background:#ffe4d1;top:-1px}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick.ngx-slider-selected{background:var(--blue-500)}::ng-deep g.axis text{font-size:.7rem}::ng-deep .custom-slider span{margin-top:0!important;padding-top:0!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ProvenanceWidgetsService }, { type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i0.ChangeDetectorRef }, { type: i0.NgZone }, { type: i2.FilterService }, { type: i2.PrimeNGConfig }, { type: i2.OverlayService }]; }, propDecorators: { mode: [{
                type: Input
            }], selected: [{
                type: Input
            }], selectedChange: [{
                type: Output
            }], iconSize: [{
                type: Input
            }], visualize: [{
                type: Input
            }], freeze: [{
                type: Input
            }], pMultiSelect: [{
                type: ViewChild,
                args: ["pMultiSelect"]
            }], provenance: [{
                type: Input
            }], provenanceChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGlzZWxlY3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcHJvdmVuYW5jZS13aWRnZXRzL3NyYy9saWIvbXVsdGlzZWxlY3QvbXVsdGlzZWxlY3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcHJvdmVuYW5jZS13aWRnZXRzL3NyYy9saWIvbXVsdGlzZWxlY3QvbXVsdGlzZWxlY3QuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBYSxLQUFLLEVBQTRELFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN0SyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEQsT0FBTyxPQUFPLE1BQU0sZ0JBQWdCLENBQUE7QUFDcEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUVwQyxPQUFPLEVBQUUsd0JBQXdCLEVBQWMsTUFBTSwrQkFBK0IsQ0FBQzs7Ozs7Ozs7OztBQVFyRixNQUFNLE9BQU8sb0JBQXFCLFNBQVEsV0FBVztJQUduRCxJQUNJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUE7SUFDdkIsQ0FBQztJQUNELElBQUksUUFBUSxDQUFDLEtBQUs7UUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsRUFBRTtZQUN4RCxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQTtTQUMvQjtRQUNELElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFBO1FBQ3hCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFBO0lBQ3hCLENBQUM7SUFZRCxJQUNJLFVBQVU7UUFDWixPQUFPLElB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QUFFLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDOUMsQ0FBQzs7a0hBcEtVLG9CQUFvQjtzR0FBcEIsb0JBQW9CLGdSQUZwQixDQUFDLHdCQUF3QixDQUFDLCtKQ1h2QyxpOUlBcUhTOzRGRHhHSSxvQkFBb0I7a0JBTmhDLFNBQVM7K0JBQ0Usd0JBQXdCLGFBR3ZCLENBQUMsd0JBQXdCLENBQUM7MFNBSTVCLElBQUk7c0JBQVosS0FBSztnQkFFRixRQUFRO3NCQURYLEtBQUs7Z0JBYUksY0FBYztzQkFBdkIsTUFBTTtnQkFDRSxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNxQixZQUFZO3NCQUF0QyxTQUFTO3VCQUFDLGNBQWM7Z0JBTXJCLFVBQVU7c0JBRGIsS0FBSztnQkFhSSxnQkFBZ0I7c0JBQXpCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uRGVzdHJveSwgSW5wdXQsIEVsZW1lbnRSZWYsIENoYW5nZURldGVjdG9yUmVmLCBOZ1pvbmUsIFJlbmRlcmVyMiwgT25Jbml0LCBWaWV3Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNdWx0aVNlbGVjdCB9IGZyb20gJ3ByaW1lbmcvbXVsdGlzZWxlY3QnO1xuaW1wb3J0IGlzRXF1YWwgZnJvbSAnbG9kYXNoLmlzZXF1YWwnXG5pbXBvcnQgeyBNT0RFIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcbmltcG9ydCB7IEZpbHRlclNlcnZpY2UsIFByaW1lTkdDb25maWcsIE92ZXJsYXlTZXJ2aWNlIH0gZnJvbSAncHJpbWVuZy9hcGknO1xuaW1wb3J0IHsgUHJvdmVuYW5jZVdpZGdldHNTZXJ2aWNlLCBQcm92ZW5hbmNlIH0gZnJvbSAnLi4vcHJvdmVuYW5jZS13aWRnZXRzLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwcm92ZW5hbmNlLW11bHRpc2VsZWN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL211bHRpc2VsZWN0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbXVsdGlzZWxlY3QuY29tcG9uZW50LnNjc3MnLCAnLi4vc2xpZGVyL3NsaWRlci5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtQcm92ZW5hbmNlV2lkZ2V0c1NlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIE11bHRpc2VsZWN0Q29tcG9uZW50IGV4dGVuZHMgTXVsdGlTZWxlY3QgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7ICBcbiAgZmlyc3RDaGFuZ2UgPSB0cnVlXG4gIEBJbnB1dCgpIG1vZGUgPSBNT0RFXG4gIEBJbnB1dCgpXG4gIGdldCBzZWxlY3RlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRcbiAgfVxuICBzZXQgc2VsZWN0ZWQodmFsdWUpIHtcbiAgICBpZiAoIXRoaXMuZmlyc3RDaGFuZ2UgJiYgIWlzRXF1YWwodGhpcy5fc2VsZWN0ZWQsIHZhbHVlKSkge1xuICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UodmFsdWUgfHwgW10pXG4gICAgfVxuICAgIHRoaXMuZmlyc3RDaGFuZ2UgPSBmYWxzZVxuICAgIHRoaXMuX3NlbGVjdGVkID0gdmFsdWVcbiAgfVxuICBfc2VsZWN0ZWQ/OiB0eXBlb2YgdGhpcy5vcHRpb25zXG5cbiAgQE91dHB1dCgpIHNlbGVjdGVkQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjx0eXBlb2YgdGhpcy5vcHRpb25zPigpXG4gIEBJbnB1dCgpIGljb25TaXplPzogbnVtYmVyXG4gIEBJbnB1dCgpIHZpc3VhbGl6ZSA9IHRydWVcbiAgQElucHV0KCkgZnJlZXplID0gZmFsc2VcbiAgQFZpZXdDaGlsZChcInBNdWx0aVNlbGVjdFwiKSBwTXVsdGlTZWxlY3QhOiBNdWx0aVNlbGVjdFxuICBpbnRlcnZhbCA9IE5hTlxuICBvcHRpb25zUmVjb3JkOiBSZWNvcmQ8c3RyaW5nLCB0eXBlb2YgdGhpcy5vcHRpb25zWzBdPiA9IHt9XG4gIG15T3ZlcmxheU9wdGlvbnMgPSB7ICdhcHBlbmRUbyc6ICdib2R5JyBhcyBjb25zdCwgLi4udGhpcy5vdmVybGF5T3B0aW9ucyB9XG5cbiAgQElucHV0KCkgXG4gIGdldCBwcm92ZW5hbmNlKCkge1xuICAgIHJldHVybiB0aGlzLl9wcm92ZW5hbmNlXG4gIH1cbiAgc2V0IHByb3ZlbmFuY2UodmFsdWUpIHtcbiAgICBpZiAodGhpcy5fcHJvdmVuYW5jZSAmJiB2YWx1ZT8ucmV2YWxpZGF0ZSkge1xuICAgICAgdGhpcy5fcHJvdmVuYW5jZSA9IHZhbHVlXG4gICAgICB0aGlzLm5nT25Jbml0KClcbiAgICAgIHRoaXMuX3Zpc3VhbGl6ZSgpXG4gICAgfVxuICAgIHRoaXMuX3Byb3ZlbmFuY2UgPSB2YWx1ZVxuICB9XG4gIF9wcm92ZW5hbmNlPzogUHJvdmVuYW5jZVxuICBAT3V0cHV0KCkgcHJvdmVuYW5jZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvdmVuYW5jZT4oKVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbXNzOiBQcm92ZW5hbmNlV2lkZ2V0c1NlcnZpY2UsXG4gICAgZWw6IEVsZW1lbnRSZWY8YW55PiwgcmVuZGVyZXI6IFJlbmRlcmVyMiwgY2Q6IENoYW5nZURldGVjdG9yUmVmLCB6b25lOiBOZ1pvbmUsIGZpbHRlclNlcnZpY2U6IEZpbHRlclNlcnZpY2UsIGNvbmZpZzogUHJpbWVOR0NvbmZpZywgb3ZlcmxheVNlcnZpY2U6IE92ZXJsYXlTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKGVsLCByZW5kZXJlciwgY2QsIHpvbmUsIGZpbHRlclNlcnZpY2UsIGNvbmZpZywgb3ZlcmxheVNlcnZpY2UpXG4gICAgbXNzLmluaXQoXG4gICAgICBlbCxcbiAgICAgIFwiLnBhbmVsXCIgKyB0aGlzLm1zcy5teUlkICsgXCIgPiBkaXYgPiB1bFwiLFxuICAgICAgXCJtdWx0aXNlbGVjdFwiLFxuICAgIClcbiAgICBtc3MuY3Jvc3NoYWlyU2VsZWN0ID0gKGtleXM6IHN0cmluZ1tdKSA9PiB7XG4gICAgICB0aGlzLnNlbGVjdGVkQ2hhbmdlLmVtaXQoa2V5cy5tYXAoKGtleSkgPT4gdGhpcy5vcHRpb25zUmVjb3JkW2tleV0pKVxuICAgIH1cbiAgfVxuXG4gIGdldElkKCkge1xuICAgIHJldHVybiB0aGlzLm1zcy5teUlkXG4gIH1cblxuICBvdmVycmlkZSBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpXG4gICAgdGhpcy5tc3Mub3B0aW9ucyA9IHRoaXMub3B0aW9ucy5sZW5ndGhcbiAgICB0aGlzLm1zcy5tb2RlID0gdGhpcy5tb2RlXG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbikgPT4ge1xuICAgICAgdGhpcy5vcHRpb25zUmVjb3JkW29wdGlvblt0aGlzLmRhdGFLZXldXSA9IG9wdGlvblxuICAgIH0pXG4gICAgaWYgKHRoaXMucHJvdmVuYW5jZT8uaGFzVXNlckludGVyYWN0ZWQgfHwgdGhpcy5wcm92ZW5hbmNlPy5yZXZhbGlkYXRlKSB7XG4gICAgICB0aGlzLm1zcy5zZXRQcm92ZW5hbmNlKHRoaXMucHJvdmVuYW5jZSlcbiAgICAgIHRoaXMuc2VsZWN0ZWQgPSBPYmplY3RcbiAgICAgICAgLmVudHJpZXModGhpcy5tc3MuZ2V0UHJvdmVuYW5jZSgpLmRhdGFCeU9wdGlvbilcbiAgICAgICAgLmZpbHRlcigoW18sIHZdKSA9PiB7XG4gICAgICAgICAgY29uc3QgbGFzdCA9IHYuYXQoLTEpXG4gICAgICAgICAgcmV0dXJuIGxhc3QgJiYgbGFzdC51bnNlbGVjdCA9PT0gdW5kZWZpbmVkICYmIGxhc3Quc2VsZWN0ICE9PSB1bmRlZmluZWRcbiAgICAgICAgfSlcbiAgICAgICAgLm1hcCgoW2ssIF9dKSA9PiB0aGlzLm9wdGlvbnNSZWNvcmRba10pXG5cbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBpZiAodGhpcy5zZWxlY3RlZCkge1xuICAgICAgdGhpcy5tc3MuYWRkU2ltdWx0YW5lb3VzRXZlbnRzKFxuICAgICAgICBbXSxcbiAgICAgICAgdGhpcy5zZWxlY3RlZC5tYXAobyA9PiBvW3RoaXMuZGF0YUtleV0pLFxuICAgICAgICB0aGlzLmZyZWV6ZSxcbiAgICAgICAgZmFsc2VcbiAgICAgIClcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgc3VwZXIubmdBZnRlclZpZXdJbml0KClcbiAgICB0aGlzLm1zcy5zZXRFbGVtZW50KHRoaXMuZWwpXG4gICAgaWYgKHRoaXMubXNzLmdldFByb3ZlbmFuY2UoKT8uaGFzVXNlckludGVyYWN0ZWQpXG4gICAgICB0aGlzLl92aXN1YWxpemUoKVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKVxuICB9XG5cbiAgaGFuZGxlSGlkZShlOiBhbnkpIHtcbiAgICB0aGlzLm9uUGFuZWxIaWRlPy5lbWl0KGUpO1xuICAgIHRoaXMub3ZlcmxheVZpc2libGUgPSBmYWxzZTtcbiAgfVxuXG4gIGhhbmRsZVNob3coZTogYW55KSB7XG4gICAgdGhpcy5vblBhbmVsU2hvdz8uZW1pdChlKTtcbiAgICB0aGlzLm92ZXJsYXlWaXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLl92aXN1YWxpemUoKTtcbiAgfVxuXG4gIGhhbmRsZUNoYW5nZSh2YWx1ZTogdHlwZW9mIHRoaXMub3B0aW9ucykge1xuICAgIHRoaXMubXNzLmFkZFNpbXVsdGFuZW91c0V2ZW50cyhcbiAgICAgIHRoaXMuc2VsZWN0ZWQgPyB0aGlzLnNlbGVjdGVkLm1hcChvID0+IG9bdGhpcy5kYXRhS2V5XSkgOiBbXSxcbiAgICAgIHZhbHVlLm1hcChvID0+IG9bdGhpcy5kYXRhS2V5XSksXG4gICAgICB0aGlzLmZyZWV6ZSxcbiAgICAgIHRydWUsXG4gICAgICBuZXcgRGF0ZSgpLFxuICAgICAgdGhpcy5wcm92ZW5hbmNlQ2hhbmdlLFxuICAgICAgdGhpcy5fdmlzdWFsaXplLmJpbmQodGhpcylcbiAgICApXG4gIH1cblxuICBfdmlzdWFsaXplKCkge1xuICAgIGlmICghdGhpcy52aXN1YWxpemUgfHwgIXRoaXMub3ZlcmxheVZpc2libGUpXG4gICAgICByZXR1cm47XG5cbiAgICBsZXQgbGk6IEhUTUxFbGVtZW50IHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkXG4gICAgZm9yIChjb25zdCBvcHRpb24gb2YgdGhpcy5vcHRpb25zKSB7XG4gICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm1zcy5teUlkICsgb3B0aW9uW3RoaXMuZGF0YUtleV0gKyAnZGl2JylcbiAgICAgIGlmIChkaXYgJiYgZGl2LnBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgbGkgPSBkaXYucGFyZW50RWxlbWVudFxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghbGkpXG4gICAgICByZXR1cm5cbiAgICAvLyBzdWJ0cmFjdGluZyBwYWRkaW5nIHZhbHVlc1xuICAgIC8vIFRPRE86IHJlbW92ZSBtYWdpYyBudW1iZXJzXG4gICAgY29uc3Qgb2Zmc2V0V2lkdGggPSBsaS5vZmZzZXRXaWR0aCAtIDQwIC0gMjIgLy9jaGVja2JveCB3aWR0aFxuICAgIGNvbnN0IG9mZnNldEhlaWdodCA9IGxpLm9mZnNldEhlaWdodCAtIDI0XG4gICAgdGhpcy5tc3MudmlzdWFsaXplKHRoaXMubW9kZSwgb2Zmc2V0V2lkdGgsIG9mZnNldEhlaWdodClcbiAgfVxuXG4gIGdldE9wdGlvbihrZXk6IHN0cmluZykge1xuICAgIGNvbnN0IGV2ZW50cyA9IHRoaXMubXNzLmRhdGFCeU9wdGlvbltrZXldPy5sZW5ndGhcbiAgICByZXR1cm4gZXZlbnRzID8gYCgke2V2ZW50c30pYCA6IFwiXCJcbiAgfVxuXG4gIGdldFByb3ZlbmFuY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMubXNzXG4gIH1cblxuICBoYW5kbGVDbGljayhidG46IEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgdGhpcy5tc3MudG9nZ2xlUHJvdmVuYW5jZU1vZGUoYnRuLCBmYWxzZSlcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucE11bHRpU2VsZWN0LnNob3coKSwgdGhpcy5wTXVsdGlTZWxlY3Qub3ZlcmxheVZpc2libGUgPyAxMDAwIDogMClcbiAgfVxuXG4gIGhhbmRsZUZpbHRlcihldmVudDogYW55KSB7XG4gICAgdGhpcy5vbkZpbHRlcj8uZW1pdChldmVudCk7XG4gICAgLy8gV2hlbiB0aGUgZmlsdGVyIGlzIGNsZWFyZWQsIGl0ZW1zIGFyZSBub3QgbWFkZSBhdmFpbGFibGUgdG8gdGhlIERPTSBpbW1lZGlhdGVseSwgc28gd2UgbmVlZCB0byB3YWl0IGEgYml0XG4gICAgLy8gVE9ETzogZmluZCBhIGJldHRlciB3YXkgdG8gaGFuZGxlIHRoaXNcbiAgICBjb25zdCB0aW1lb3V0ID0gZXZlbnQuZmlsdGVyID8gMCA6IDEwMFxuICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5fdmlzdWFsaXplKCksIHRpbWVvdXQpXG4gIH1cblxufVxuIiwiPGRpdiBjbGFzcz1cInAtaW5wdXRncm91cCBmbGV4IGZsZXgtcm93IGdhcC0zXCI+XG4gICAgPGJ1dHRvblxuICAgICpuZ0lmPVwidmlzdWFsaXplXCJcbiAgICBwQnV0dG9uXG4gICAgdHlwZT1cImJ1dHRvblwiXG4gICAgY2xhc3M9XCJwLWJ1dHRvbi1oZWxwIHAtYnV0dG9uLXRleHRcIlxuICAgIFtkaXNhYmxlZF09XCIhZ2V0UHJvdmVuYW5jZSgpLmhhc1VzZXJJbnRlcmFjdGVkXCJcbiAgICBbbmdTdHlsZV09XCJ7ICdwYWRkaW5nJzogMCwgJ2FsaWduLXNlbGYnOiAnY2VudGVyJywgJ2hlaWdodCc6ICdtaW4tY29udGVudCcsICd2aXNpYmlsaXR5JzogdmlzdWFsaXplID8gJ3Zpc2libGUnIDogJ2hpZGRlbid9XCJcbiAgICAjYnRuXG4gICAgKGNsaWNrKT1cImhhbmRsZUNsaWNrKGJ0bilcIlxuICAgPlxuICAgIDxwcm92ZW5hbmNlLWljb24gXG4gICAgW2ljb25dPVwiIWdldFByb3ZlbmFuY2UoKS5oYXNVc2VySW50ZXJhY3RlZCA/ICdkaXNhYmxlZCcgOiBnZXRQcm92ZW5hbmNlKCkucHJvdmVuYW5jZU1vZGVcIlxuICAgIFtzaXplXT1cImljb25TaXplXCJcbiAgICA+PC9wcm92ZW5hbmNlLWljb24+XG4gICA8L2J1dHRvbj5cbiAgIDxwLW11bHRpU2VsZWN0XG4gICAgI3BNdWx0aVNlbGVjdCBcbiAgICBbYXBwZW5kVG9dPVwiYXBwZW5kVG9cIiBcbiAgICBbYXJpYUZpbHRlckxhYmVsXT1cImFyaWFGaWx0ZXJMYWJlbFwiIFxuICAgIFtsYWJlbF09XCJsYWJlbFwiXG4gICAgW2FyaWFMYWJlbGxlZEJ5XT1cImFyaWFMYWJlbGxlZEJ5XCJcbiAgICBbYXV0b2ZvY3VzRmlsdGVyXT1cImF1dG9mb2N1c0ZpbHRlclwiXG4gICAgW2F1dG9aSW5kZXhdPVwiYXV0b1pJbmRleFwiXG4gICAgW2Jhc2VaSW5kZXhdPVwiYmFzZVpJbmRleFwiXG4gICAgW2RlZmF1bHRMYWJlbF09XCJkZWZhdWx0TGFiZWxcIlxuICAgIFtkYXRhS2V5XT1cImRhdGFLZXlcIlxuICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgW2Rpc3BsYXlTZWxlY3RlZExhYmVsXT1cImRpc3BsYXlTZWxlY3RlZExhYmVsXCJcbiAgICBbZHJvcGRvd25JY29uXT1cImRyb3Bkb3duSWNvblwiXG4gICAgW2VtcHR5RmlsdGVyTWVzc2FnZV09XCJlbXB0eUZpbHRlck1lc3NhZ2VcIlxuICAgIFtmaWx0ZXJdPVwiZmlsdGVyXCJcbiAgICBbZmlsdGVyTWF0Y2hNb2RlXT1cImZpbHRlck1hdGNoTW9kZVwiXG4gICAgW2ZpbHRlclZhbHVlXT1cImZpbHRlclZhbHVlXCJcbiAgICBbZmlsdGVyTG9jYWxlXT1cImZpbHRlckxvY2FsZVwiXG4gICAgW2ZpbHRlckJ5XT1cImZpbHRlckJ5XCJcbiAgICBbZmlsdGVyUGxhY2VIb2xkZXJdPVwiZmlsdGVyUGxhY2VIb2xkZXJcIlxuICAgIFtoaWRlVHJhbnNpdGlvbk9wdGlvbnNdPVwiaGlkZVRyYW5zaXRpb25PcHRpb25zXCJcbiAgICBbaW5wdXRJZF09XCJpbnB1dElkXCJcbiAgICBbbWF4U2VsZWN0ZWRMYWJlbHNdPVwibWF4U2VsZWN0ZWRMYWJlbHMgfHwgM1wiXG4gICAgW25hbWVdPVwibmFtZVwiXG4gICAgW29wdGlvbnNdPVwib3B0aW9uc1wiXG4gICAgW29wdGlvbkxhYmVsXT1cIm9wdGlvbkxhYmVsXCJcbiAgICBbb3B0aW9uVmFsdWVdPVwib3B0aW9uVmFsdWVcIlxuICAgIFtvcHRpb25EaXNhYmxlZF09XCJvcHRpb25EaXNhYmxlZFwiXG4gICAgW29wdGlvbkdyb3VwTGFiZWxdPVwib3B0aW9uR3JvdXBMYWJlbFwiXG4gICAgW29wdGlvbkdyb3VwQ2hpbGRyZW5dPVwib3B0aW9uR3JvdXBDaGlsZHJlblwiXG4gICAgW2dyb3VwXT1cImdyb3VwXCJcbiAgICBbb3ZlcmxheVZpc2libGVdPVwib3ZlcmxheVZpc2libGVcIlxuICAgIFtwYW5lbFN0eWxlXT1cInBhbmVsU3R5bGVcIlxuICAgIFtwbGFjZWhvbGRlcl09XCJwbGFjZWhvbGRlclwiXG4gICAgW3JlYWRvbmx5XT1cInJlYWRvbmx5XCJcbiAgICBbZW1wdHlNZXNzYWdlXT1cImVtcHR5TWVzc2FnZVwiXG4gICAgW2VtcHR5RmlsdGVyTWVzc2FnZV09XCJlbXB0eUZpbHRlck1lc3NhZ2VcIlxuICAgIFtyZXNldEZpbHRlck9uSGlkZV09XCJyZXNldEZpbHRlck9uSGlkZVwiXG4gICAgW3Njcm9sbEhlaWdodF09XCJzY3JvbGxIZWlnaHRcIlxuICAgIFtzZWxlY3RlZEl0ZW1zTGFiZWxdPVwic2VsZWN0ZWRJdGVtc0xhYmVsXCJcbiAgICBbc2VsZWN0aW9uTGltaXRdPVwic2VsZWN0aW9uTGltaXRcIlxuICAgIFtzaG93SGVhZGVyXT1cInNob3dIZWFkZXJcIlxuICAgIFtzaG93VHJhbnNpdGlvbk9wdGlvbnNdPVwic2hvd1RyYW5zaXRpb25PcHRpb25zXCJcbiAgICBbc2hvd1RvZ2dsZUFsbF09XCJzaG93VG9nZ2xlQWxsXCJcbiAgICBbc3R5bGVdPVwic3R5bGVcIlxuICAgIFtzdHlsZUNsYXNzXT1cIihzdHlsZUNsYXNzIHx8ICcnKSArICcgcHJvdmVuYW5jZS1tdWx0aXNlbGVjdCdcIlxuICAgIFtwYW5lbFN0eWxlQ2xhc3NdPVwiKHBhbmVsU3R5bGVDbGFzcyB8fCAnJykgKyAncHJvdmVuYW5jZS1tdWx0aXNlbGVjdC1wYW5lbCBwYW5lbCcgKyB0aGlzLmdldElkKClcIlxuICAgIFt0YWJpbmRleF09XCJ0YWJpbmRleFwiXG4gICAgW3Rvb2x0aXBdPVwidG9vbHRpcFwiXG4gICAgW3Rvb2x0aXBTdHlsZUNsYXNzXT1cInRvb2x0aXBTdHlsZUNsYXNzXCJcbiAgICBbdG9vbHRpcFBvc2l0aW9uXT1cInRvb2x0aXBQb3NpdGlvblwiXG4gICAgW3Rvb2x0aXBQb3NpdGlvblN0eWxlXT1cInRvb2x0aXBQb3NpdGlvblN0eWxlXCJcbiAgICBbc2hvd0NsZWFyXT1cInNob3dDbGVhclwiXG4gICAgW3ZpcnR1YWxTY3JvbGxdPVwidmlydHVhbFNjcm9sbFwiXG4gICAgW3ZpcnR1YWxTY3JvbGxJdGVtU2l6ZV09XCJ2aXJ0dWFsU2Nyb2xsSXRlbVNpemVcIlxuICAgIFt2aXJ0dWFsU2Nyb2xsT3B0aW9uc109XCJ2aXJ0dWFsU2Nyb2xsT3B0aW9uc1wiXG4gICAgW292ZXJsYXlPcHRpb25zXT1cIm15T3ZlcmxheU9wdGlvbnNcIlxuICAgIFtsYXp5XT1cImxhenlcIlxuICAgIChvbkNsaWNrKT1cIm9uQ2xpY2tcIlxuICAgIChvbkNoYW5nZSk9XCJvbkNoYW5nZVwiXG4gICAgKG9uRmlsdGVyKT1cImhhbmRsZUZpbHRlcigkZXZlbnQpXCJcbiAgICAob25Gb2N1cyk9XCJvbkZvY3VzXCJcbiAgICAob25CbHVyKT1cIm9uQmx1clwiXG4gICAgKG9uUGFuZWxTaG93KT1cImhhbmRsZVNob3coJGV2ZW50KVwiXG4gICAgKG9uUGFuZWxIaWRlKT1cImhhbmRsZUhpZGUoJGV2ZW50KVwiXG4gICAgKG9uQ2xlYXIpPVwib25DbGVhclwiXG4gICAgKG9uTGF6eUxvYWQpPVwib25MYXp5TG9hZFwiXG4gICAgKG9uUmVtb3ZlKT1cIm9uUmVtb3ZlXCJcbiAgICAobmdNb2RlbENoYW5nZSk9XCJ0aGlzLmdldFByb3ZlbmFuY2UoKS5pbnRlcmFjdGlvbiA9ICd1c2VyLWNoYW5nZSc7IHNlbGVjdGVkQ2hhbmdlLmVtaXQoJGV2ZW50KVwiXG4gICAgW25nTW9kZWxdPVwic2VsZWN0ZWRcIlxuICAgID5cbiAgICAgIDxuZy10ZW1wbGF0ZSBsZXQtb3B0aW9uIHBUZW1wbGF0ZT1cIml0ZW1cIj5cbiAgICAgICAgPGRpdiBzdHlsZT1cInBvc2l0aW9uOiByZWxhdGl2ZTsgd2lkdGg6IDEwMCU7XCIgW2lkXT1cImdldElkKCkgKyBvcHRpb25bZGF0YUtleV0gKyAnZGl2J1wiPlxuICAgICAgICAgIDxzdmcgXG4gICAgICAgICAgICBbaWRdPVwiZ2V0SWQoKSArIG9wdGlvbltkYXRhS2V5XVwiIFxuICAgICAgICAgICAgd2lkdGg9XCIwXCIgXG4gICAgICAgICAgICBoZWlnaHQ9XCIwXCJcbiAgICAgICAgICAgIFtzdHlsZV09XCJ7ICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsICdkaXNwbGF5JzogZ2V0UHJvdmVuYW5jZSgpLmhhc1VzZXJJbnRlcmFjdGVkID8gJ2luaXRpYWwnIDogJ25vbmUnIH1cIlxuICAgICAgICAgID48L3N2Zz5cbiAgICAgICAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBwb3NpdGlvbjogaW5oZXJpdDtcIj5cbiAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICB7eyBvcHRpb25bb3B0aW9uTGFiZWxdIH19XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJmb290ZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN1c3RvbS1zbGlkZXIgdGVtcG9yYWwtc2xpZGVyXCI+XG4gICAgICAgICAgPG5neC1zbGlkZXJcbiAgICAgICAgICAgICpuZ0lmPVwiZ2V0UHJvdmVuYW5jZSgpLnByb3ZlbmFuY2VNb2RlID09PSAndGVtcG9yYWwnXCJcbiAgICAgICAgICAgIFt2YWx1ZV09XCJnZXRQcm92ZW5hbmNlKCkudGVtcG9yYWxGaWx0ZXJSYW5nZVswXVwiXG4gICAgICAgICAgICBbaGlnaFZhbHVlXT1cImdldFByb3ZlbmFuY2UoKS50ZW1wb3JhbEZpbHRlclJhbmdlWzFdXCJcbiAgICAgICAgICAgIFtvcHRpb25zXT1cImdldFByb3ZlbmFuY2UoKS50ZW1wb3JhbE9wdGlvbnNcIlxuICAgICAgICAgICAgKHVzZXJDaGFuZ2VFbmQpPVwiZ2V0UHJvdmVuYW5jZSgpLnNldFRlbXBvcmFsUmFuZ2UoJGV2ZW50KVwiXG4gICAgICAgICAgPlxuICAgICAgICAgIDwvbmd4LXNsaWRlcj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgIDwvcC1tdWx0aVNlbGVjdD5cbiAgXG4gICA8L2Rpdj4iXX0=