import { Component, EventEmitter, Input, Output } from '@angular/core';
import { Checkbox } from 'primeng/checkbox';
import { MODE } from '../constants';
import { ProvenanceWidgetsService } from '../provenance-widgets.service';
import isEqual from 'lodash.isequal';
import * as i0 from "@angular/core";
import * as i1 from "../provenance-widgets.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular-slider/ngx-slider";
import * as i4 from "primeng/button";
import * as i5 from "@angular/forms";
import * as i6 from "primeng/checkbox";
import * as i7 from "../icon/icon.component";
export class CheckboxComponent extends Checkbox {
    get selected() {
        return this._selected;
    }
    set selected(value) {
        if (!this.firstChange && !isEqual(this._selected, value)) {
            this.change(value || []);
        }
        this.firstChange = false;
        this._selected = value;
    }
    get provenance() {
        return this._provenance;
    }
    set provenance(value) {
        if (this._provenance && value?.revalidate) {
            this._provenance = value;
            this.ngOnInit();
            this._visualize();
            return;
        }
        this._provenance = value;
    }
    constructor(mss, el, cd) {
        super(cd);
        this.mss = mss;
        this.el = el;
        this.firstChange = true;
        this.mode = MODE;
        this.visualize = true;
        this.freeze = false;
        this.selectedChange = new EventEmitter();
        this.interval = NaN;
        this.provenanceChange = new EventEmitter();
        mss.init(el, undefined, "checkbox");
        mss.crosshairSelect = (keys) => {
            this.selectedChange.emit(keys);
        };
    }
    ngOnInit() {
        this.mss.options = this.data.length;
        this.mss.mode = this.mode;
        if (this.provenance?.hasUserInteracted || this.provenance?.revalidate) {
            this.mss.setProvenance(this.provenance);
            this.selected = Object
                .entries(this.mss.getProvenance().dataByOption)
                .filter(([_, v]) => {
                const last = v.at(-1);
                return last && last.unselect === undefined && last.select !== undefined;
            })
                .map(([k, _]) => k);
            return;
        }
        if (this.selected) {
            this.mss.addSimultaneousEvents([], this.selected, this.freeze, false);
        }
    }
    ngAfterViewInit() {
        this.mss.setElement(this.el);
        if (this.mss.getProvenance()?.hasUserInteracted)
            this._visualize();
    }
    getId() {
        return this.mss.myId;
    }
    ngOnDestroy() {
        clearInterval(this.interval);
    }
    change(e) {
        this.mss.addSimultaneousEvents(this.selected || [], e, this.freeze, true, new Date(), this.provenanceChange, this._visualize.bind(this));
    }
    _visualize() {
        if (!this.visualize)
            return;
        // TODO: Remove magic numbers
        const width = this.el.nativeElement.offsetWidth - 22 - 8; // checkbox width + margin
        const height = 22;
        this.mss.visualize(this.mode, width, height, "0 0 0 30px");
    }
    getProvenance() {
        return this.mss;
    }
}
CheckboxComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: CheckboxComponent, deps: [{ token: i1.ProvenanceWidgetsService }, { token: i0.ElementRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
CheckboxComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: CheckboxComponent, selector: "provenance-checkbox", inputs: { mode: "mode", data: "data", selected: "selected", visualize: "visualize", freeze: "freeze", provenance: "provenance" }, outputs: { selectedChange: "selectedChange", provenanceChange: "provenanceChange" }, providers: [ProvenanceWidgetsService], usesInheritance: true, ngImport: i0, template: "<div\n    style=\"display: flex; margin-bottom: 1rem; margin-top: 1rem;\"\n>\n    <button\n        *ngIf=\"visualize\"\n        pButton\n        type=\"button\"\n        class=\"p-button-help p-button-text\"\n        [disabled]=\"!getProvenance().hasUserInteracted\"\n        [style]=\"{'margin-right': '0.5rem', 'height': '22px', 'width': '22px', 'padding': '0px', 'visibility': visualize ? 'visible' : 'hidden'}\"\n        #btn\n        (click)=\"getProvenance().toggleProvenanceMode(btn, true)\"\n    >\n    <provenance-icon \n        [icon]=\"!getProvenance().hasUserInteracted ? 'disabled' : getProvenance().provenanceMode\"\n        [size]=\"20\"\n        style=\"height: 20px;\"\n    ></provenance-icon>\n    </button>\n    <div class=\"custom-slider\" style=\"width: 100%\">\n        <ngx-slider\n            *ngIf=\"getProvenance().provenanceMode === 'temporal'\"\n            [value]=\"getProvenance().temporalFilterRange[0]\"\n            [highValue]=\"getProvenance().temporalFilterRange[1]\"\n            [options]=\"getProvenance().temporalOptions\"\n            (userChangeEnd)=\"getProvenance().setTemporalRange($event)\"\n            style=\"margin-top: 0px\"\n        >\n        </ngx-slider>\n    </div>\n</div>\n<div \n    *ngFor=\"let d of data\" \n    class=\"field-checkbox\"\n    style=\"position: relative;\"\n>\n    <svg\n        [id]=\"getId() + d[value || 'value']\"\n        width=\"0\"\n        height=\"0\"\n        style=\"position: absolute;\"\n    >\n    </svg>\n    <p-checkbox\n        [inputId]=\"d[inputId || 'inputId'] || null\"\n        [name]=\"d[name || 'name'] || null\"\n        [value]=\"d[value || 'value'] || null\"\n        [label]=\"d[label || 'label'] || null\"\n        [disabled]=\"d['disabled'] || false\"\n        [binary]=\"d['binary'] || false\"\n        [tabindex]=\"d['tabindex'] || null\"\n        [style]=\"d['style'] || style || null\"\n        [styleClass]=\"d['styleClass'] || styleClass || null\"\n        [labelStyleClass]=\"d['labelStyleClass'] || labelStyleClass || null\"\n        [checkboxIcon]=\"d['checkboxIcon'] || 'pi pi-check'\"\n        [readonly]=\"d['readonly'] || false\"\n        [required]=\"d['required'] || false\"\n        [trueValue]=\"d['trueValue'] || true\"\n        [falseValue]=\"d['falseValue'] || false\"\n        (ngModelChange)=\"this.getProvenance().interaction = 'user-change'; selectedChange.emit($event)\"\n        [ngModel]=\"selected\"\n        (onBlur)=\"onBlur\"\n        (onClick)=\"onClick\"\n        (onChange)=\"onChange\"\n    >\n    </p-checkbox>\n</div>", styles: ["::ng-deep p-checkbox{z-index:2}\n", "::ng-deep .custom-slider .ngx-slider .ngx-slider-bar{background:lightgray;height:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-selection{background:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer{width:8px;height:16px;top:auto;bottom:0;background-color:#333;border-top-left-radius:3px;border-top-right-radius:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer:after{display:none}::ng-deep .custom-slider:not(.temporal-slider) .ngx-slider .ngx-slider-bubble{top:5px}::ng-deep .custom-slider .ngx-slider .ngx-slider-limit{font-weight:700;color:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick{width:1px;height:10px;margin-left:4px;border-radius:0;background:#ffe4d1;top:-1px}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick.ngx-slider-selected{background:var(--blue-500)}::ng-deep g.axis text{font-size:.7rem}::ng-deep .custom-slider span{margin-top:0!important;padding-top:0!important}\n"], dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.SliderComponent, selector: "ngx-slider", inputs: ["value", "highValue", "options", "manualRefresh", "triggerFocus"], outputs: ["valueChange", "highValueChange", "userChangeStart", "userChange", "userChangeEnd"] }, { kind: "directive", type: i4.ButtonDirective, selector: "[pButton]", inputs: ["iconPos", "loadingIcon", "label", "icon", "loading"] }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "directive", type: i5.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i6.Checkbox, selector: "p-checkbox", inputs: ["value", "name", "disabled", "binary", "label", "ariaLabelledBy", "ariaLabel", "tabindex", "inputId", "style", "styleClass", "labelStyleClass", "formControl", "checkboxIcon", "readonly", "required", "trueValue", "falseValue"], outputs: ["onChange"] }, { kind: "component", type: i7.IconComponent, selector: "provenance-icon", inputs: ["icon", "size"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: CheckboxComponent, decorators: [{
            type: Component,
            args: [{ selector: 'provenance-checkbox', providers: [ProvenanceWidgetsService], template: "<div\n    style=\"display: flex; margin-bottom: 1rem; margin-top: 1rem;\"\n>\n    <button\n        *ngIf=\"visualize\"\n        pButton\n        type=\"button\"\n        class=\"p-button-help p-button-text\"\n        [disabled]=\"!getProvenance().hasUserInteracted\"\n        [style]=\"{'margin-right': '0.5rem', 'height': '22px', 'width': '22px', 'padding': '0px', 'visibility': visualize ? 'visible' : 'hidden'}\"\n        #btn\n        (click)=\"getProvenance().toggleProvenanceMode(btn, true)\"\n    >\n    <provenance-icon \n        [icon]=\"!getProvenance().hasUserInteracted ? 'disabled' : getProvenance().provenanceMode\"\n        [size]=\"20\"\n        style=\"height: 20px;\"\n    ></provenance-icon>\n    </button>\n    <div class=\"custom-slider\" style=\"width: 100%\">\n        <ngx-slider\n            *ngIf=\"getProvenance().provenanceMode === 'temporal'\"\n            [value]=\"getProvenance().temporalFilterRange[0]\"\n            [highValue]=\"getProvenance().temporalFilterRange[1]\"\n            [options]=\"getProvenance().temporalOptions\"\n            (userChangeEnd)=\"getProvenance().setTemporalRange($event)\"\n            style=\"margin-top: 0px\"\n        >\n        </ngx-slider>\n    </div>\n</div>\n<div \n    *ngFor=\"let d of data\" \n    class=\"field-checkbox\"\n    style=\"position: relative;\"\n>\n    <svg\n        [id]=\"getId() + d[value || 'value']\"\n        width=\"0\"\n        height=\"0\"\n        style=\"position: absolute;\"\n    >\n    </svg>\n    <p-checkbox\n        [inputId]=\"d[inputId || 'inputId'] || null\"\n        [name]=\"d[name || 'name'] || null\"\n        [value]=\"d[value || 'value'] || null\"\n        [label]=\"d[label || 'label'] || null\"\n        [disabled]=\"d['disabled'] || false\"\n        [binary]=\"d['binary'] || false\"\n        [tabindex]=\"d['tabindex'] || null\"\n        [style]=\"d['style'] || style || null\"\n        [styleClass]=\"d['styleClass'] || styleClass || null\"\n        [labelStyleClass]=\"d['labelStyleClass'] || labelStyleClass || null\"\n        [checkboxIcon]=\"d['checkboxIcon'] || 'pi pi-check'\"\n        [readonly]=\"d['readonly'] || false\"\n        [required]=\"d['required'] || false\"\n        [trueValue]=\"d['trueValue'] || true\"\n        [falseValue]=\"d['falseValue'] || false\"\n        (ngModelChange)=\"this.getProvenance().interaction = 'user-change'; selectedChange.emit($event)\"\n        [ngModel]=\"selected\"\n        (onBlur)=\"onBlur\"\n        (onClick)=\"onClick\"\n        (onChange)=\"onChange\"\n    >\n    </p-checkbox>\n</div>", styles: ["::ng-deep p-checkbox{z-index:2}\n", "::ng-deep .custom-slider .ngx-slider .ngx-slider-bar{background:lightgray;height:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-selection{background:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer{width:8px;height:16px;top:auto;bottom:0;background-color:#333;border-top-left-radius:3px;border-top-right-radius:3px}::ng-deep .custom-slider .ngx-slider .ngx-slider-pointer:after{display:none}::ng-deep .custom-slider:not(.temporal-slider) .ngx-slider .ngx-slider-bubble{top:5px}::ng-deep .custom-slider .ngx-slider .ngx-slider-limit{font-weight:700;color:var(--blue-500)}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick{width:1px;height:10px;margin-left:4px;border-radius:0;background:#ffe4d1;top:-1px}::ng-deep .custom-slider .ngx-slider .ngx-slider-tick.ngx-slider-selected{background:var(--blue-500)}::ng-deep g.axis text{font-size:.7rem}::ng-deep .custom-slider span{margin-top:0!important;padding-top:0!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ProvenanceWidgetsService }, { type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { mode: [{
                type: Input
            }], data: [{
                type: Input
            }], selected: [{
                type: Input
            }], visualize: [{
                type: Input
            }], freeze: [{
                type: Input
            }], selectedChange: [{
                type: Output
            }], provenance: [{
                type: Input
            }], provenanceChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3guY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcHJvdmVuYW5jZS13aWRnZXRzL3NyYy9saWIvY2hlY2tib3gvY2hlY2tib3guY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcHJvdmVuYW5jZS13aWRnZXRzL3NyYy9saWIvY2hlY2tib3gvY2hlY2tib3guY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFvQyxTQUFTLEVBQWMsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hJLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3BDLE9BQU8sRUFBRSx3QkFBd0IsRUFBYyxNQUFNLCtCQUErQixDQUFDO0FBQ3JGLE9BQU8sT0FBTyxNQUFNLGdCQUFnQixDQUFBOzs7Ozs7Ozs7QUFRcEMsTUFBTSxPQUFPLGlCQUFrQixTQUFRLFFBQVE7SUFJN0MsSUFDSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFBO0lBQ3ZCLENBQUM7SUFDRCxJQUFJLFFBQVEsQ0FBQyxLQUFLO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDeEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUE7U0FDekI7UUFDRCxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQTtRQUN4QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQTtJQUN4QixDQUFDO0lBTUQsSUFDSSxVQUFVO1FBQ1osT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFBO0lBQ3pCLENB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c0JBRGIsS0FBSztnQkFjSSxnQkFBZ0I7c0JBQXpCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDaGVja2JveCB9IGZyb20gJ3ByaW1lbmcvY2hlY2tib3gnO1xuaW1wb3J0IHsgTU9ERSB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBQcm92ZW5hbmNlV2lkZ2V0c1NlcnZpY2UsIFByb3ZlbmFuY2UgfSBmcm9tICcuLi9wcm92ZW5hbmNlLXdpZGdldHMuc2VydmljZSc7XG5pbXBvcnQgaXNFcXVhbCBmcm9tICdsb2Rhc2guaXNlcXVhbCdcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncHJvdmVuYW5jZS1jaGVja2JveCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9jaGVja2JveC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NoZWNrYm94LmNvbXBvbmVudC5zY3NzJywgJy4uL3NsaWRlci9zbGlkZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbUHJvdmVuYW5jZVdpZGdldHNTZXJ2aWNlXVxufSlcbmV4cG9ydCBjbGFzcyBDaGVja2JveENvbXBvbmVudCBleHRlbmRzIENoZWNrYm94IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBmaXJzdENoYW5nZSA9IHRydWVcbiAgQElucHV0KCkgbW9kZSA9IE1PREVcbiAgQElucHV0KCkgZGF0YSE6IFJlY29yZDxhbnksIGFueT5bXVxuICBASW5wdXQoKVxuICBnZXQgc2VsZWN0ZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkXG4gIH1cbiAgc2V0IHNlbGVjdGVkKHZhbHVlKSB7XG4gICAgaWYgKCF0aGlzLmZpcnN0Q2hhbmdlICYmICFpc0VxdWFsKHRoaXMuX3NlbGVjdGVkLCB2YWx1ZSkpIHtcbiAgICAgIHRoaXMuY2hhbmdlKHZhbHVlIHx8IFtdKVxuICAgIH1cbiAgICB0aGlzLmZpcnN0Q2hhbmdlID0gZmFsc2VcbiAgICB0aGlzLl9zZWxlY3RlZCA9IHZhbHVlXG4gIH1cbiAgX3NlbGVjdGVkPzogc3RyaW5nW11cbiAgQElucHV0KCkgdmlzdWFsaXplID0gdHJ1ZVxuICBASW5wdXQoKSBmcmVlemUgPSBmYWxzZVxuICBAT3V0cHV0KCkgc2VsZWN0ZWRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZ1tdPigpXG4gIGludGVydmFsID0gTmFOXG4gIEBJbnB1dCgpIFxuICBnZXQgcHJvdmVuYW5jZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fcHJvdmVuYW5jZVxuICB9XG4gIHNldCBwcm92ZW5hbmNlKHZhbHVlKSB7XG4gICAgaWYgKHRoaXMuX3Byb3ZlbmFuY2UgJiYgdmFsdWU/LnJldmFsaWRhdGUpIHtcbiAgICAgIHRoaXMuX3Byb3ZlbmFuY2UgPSB2YWx1ZVxuICAgICAgdGhpcy5uZ09uSW5pdCgpXG4gICAgICB0aGlzLl92aXN1YWxpemUoKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHRoaXMuX3Byb3ZlbmFuY2UgPSB2YWx1ZVxuICB9XG4gIF9wcm92ZW5hbmNlPzogUHJvdmVuYW5jZVxuICBAT3V0cHV0KCkgcHJvdmVuYW5jZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvdmVuYW5jZT4oKVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbXNzOiBQcm92ZW5hbmNlV2lkZ2V0c1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICkge1xuICAgIHN1cGVyKGNkKVxuICAgIG1zcy5pbml0KGVsLCB1bmRlZmluZWQsIFwiY2hlY2tib3hcIilcbiAgICBtc3MuY3Jvc3NoYWlyU2VsZWN0ID0gKGtleXM6IHN0cmluZ1tdKSA9PiB7XG4gICAgICB0aGlzLnNlbGVjdGVkQ2hhbmdlLmVtaXQoa2V5cylcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLm1zcy5vcHRpb25zID0gdGhpcy5kYXRhLmxlbmd0aFxuICAgIHRoaXMubXNzLm1vZGUgPSB0aGlzLm1vZGVcbiAgICBpZiAodGhpcy5wcm92ZW5hbmNlPy5oYXNVc2VySW50ZXJhY3RlZCB8fCB0aGlzLnByb3ZlbmFuY2U/LnJldmFsaWRhdGUpIHtcbiAgICAgIHRoaXMubXNzLnNldFByb3ZlbmFuY2UodGhpcy5wcm92ZW5hbmNlKVxuICAgICAgdGhpcy5zZWxlY3RlZCA9IE9iamVjdFxuICAgICAgICAuZW50cmllcyh0aGlzLm1zcy5nZXRQcm92ZW5hbmNlKCkuZGF0YUJ5T3B0aW9uKVxuICAgICAgICAuZmlsdGVyKChbXywgdl0pID0+IHtcbiAgICAgICAgICBjb25zdCBsYXN0ID0gdi5hdCgtMSlcbiAgICAgICAgICByZXR1cm4gbGFzdCAmJiBsYXN0LnVuc2VsZWN0ID09PSB1bmRlZmluZWQgJiYgbGFzdC5zZWxlY3QgIT09IHVuZGVmaW5lZFxuICAgICAgICB9KVxuICAgICAgICAubWFwKChbaywgX10pID0+IGspO1xuXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgIHRoaXMubXNzLmFkZFNpbXVsdGFuZW91c0V2ZW50cyhcbiAgICAgICAgW10sXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQsXG4gICAgICAgIHRoaXMuZnJlZXplLFxuICAgICAgICBmYWxzZVxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLm1zcy5zZXRFbGVtZW50KHRoaXMuZWwpXG4gICAgaWYgKHRoaXMubXNzLmdldFByb3ZlbmFuY2UoKT8uaGFzVXNlckludGVyYWN0ZWQpXG4gICAgICB0aGlzLl92aXN1YWxpemUoKVxuICB9XG5cbiAgZ2V0SWQoKSB7XG4gICAgcmV0dXJuIHRoaXMubXNzLm15SWRcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbClcbiAgfVxuXG4gIGNoYW5nZShlOiBzdHJpbmdbXSkge1xuICAgIHRoaXMubXNzLmFkZFNpbXVsdGFuZW91c0V2ZW50cyhcbiAgICAgIHRoaXMuc2VsZWN0ZWQgfHwgW10sXG4gICAgICBlLFxuICAgICAgdGhpcy5mcmVlemUsXG4gICAgICB0cnVlLFxuICAgICAgbmV3IERhdGUoKSxcbiAgICAgIHRoaXMucHJvdmVuYW5jZUNoYW5nZSxcbiAgICAgIHRoaXMuX3Zpc3VhbGl6ZS5iaW5kKHRoaXMpXG4gICAgKVxuICB9XG5cbiAgX3Zpc3VhbGl6ZSgpIHtcbiAgICBpZiAoIXRoaXMudmlzdWFsaXplKVxuICAgICAgcmV0dXJuXG4gICAgLy8gVE9ETzogUmVtb3ZlIG1hZ2ljIG51bWJlcnNcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCAtIDIyIC0gOCAvLyBjaGVja2JveCB3aWR0aCArIG1hcmdpblxuICAgIGNvbnN0IGhlaWdodCA9IDIyXG4gICAgdGhpcy5tc3MudmlzdWFsaXplKHRoaXMubW9kZSwgd2lkdGgsIGhlaWdodCwgXCIwIDAgMCAzMHB4XCIpXG4gIH1cblxuICBnZXRQcm92ZW5hbmNlKCkge1xuICAgIHJldHVybiB0aGlzLm1zc1xuICB9XG59XG4iLCI8ZGl2XG4gICAgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBtYXJnaW4tYm90dG9tOiAxcmVtOyBtYXJnaW4tdG9wOiAxcmVtO1wiXG4+XG4gICAgPGJ1dHRvblxuICAgICAgICAqbmdJZj1cInZpc3VhbGl6ZVwiXG4gICAgICAgIHBCdXR0b25cbiAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgIGNsYXNzPVwicC1idXR0b24taGVscCBwLWJ1dHRvbi10ZXh0XCJcbiAgICAgICAgW2Rpc2FibGVkXT1cIiFnZXRQcm92ZW5hbmNlKCkuaGFzVXNlckludGVyYWN0ZWRcIlxuICAgICAgICBbc3R5bGVdPVwieydtYXJnaW4tcmlnaHQnOiAnMC41cmVtJywgJ2hlaWdodCc6ICcyMnB4JywgJ3dpZHRoJzogJzIycHgnLCAncGFkZGluZyc6ICcwcHgnLCAndmlzaWJpbGl0eSc6IHZpc3VhbGl6ZSA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nfVwiXG4gICAgICAgICNidG5cbiAgICAgICAgKGNsaWNrKT1cImdldFByb3ZlbmFuY2UoKS50b2dnbGVQcm92ZW5hbmNlTW9kZShidG4sIHRydWUpXCJcbiAgICA+XG4gICAgPHByb3ZlbmFuY2UtaWNvbiBcbiAgICAgICAgW2ljb25dPVwiIWdldFByb3ZlbmFuY2UoKS5oYXNVc2VySW50ZXJhY3RlZCA/ICdkaXNhYmxlZCcgOiBnZXRQcm92ZW5hbmNlKCkucHJvdmVuYW5jZU1vZGVcIlxuICAgICAgICBbc2l6ZV09XCIyMFwiXG4gICAgICAgIHN0eWxlPVwiaGVpZ2h0OiAyMHB4O1wiXG4gICAgPjwvcHJvdmVuYW5jZS1pY29uPlxuICAgIDwvYnV0dG9uPlxuICAgIDxkaXYgY2xhc3M9XCJjdXN0b20tc2xpZGVyXCIgc3R5bGU9XCJ3aWR0aDogMTAwJVwiPlxuICAgICAgICA8bmd4LXNsaWRlclxuICAgICAgICAgICAgKm5nSWY9XCJnZXRQcm92ZW5hbmNlKCkucHJvdmVuYW5jZU1vZGUgPT09ICd0ZW1wb3JhbCdcIlxuICAgICAgICAgICAgW3ZhbHVlXT1cImdldFByb3ZlbmFuY2UoKS50ZW1wb3JhbEZpbHRlclJhbmdlWzBdXCJcbiAgICAgICAgICAgIFtoaWdoVmFsdWVdPVwiZ2V0UHJvdmVuYW5jZSgpLnRlbXBvcmFsRmlsdGVyUmFuZ2VbMV1cIlxuICAgICAgICAgICAgW29wdGlvbnNdPVwiZ2V0UHJvdmVuYW5jZSgpLnRlbXBvcmFsT3B0aW9uc1wiXG4gICAgICAgICAgICAodXNlckNoYW5nZUVuZCk9XCJnZXRQcm92ZW5hbmNlKCkuc2V0VGVtcG9yYWxSYW5nZSgkZXZlbnQpXCJcbiAgICAgICAgICAgIHN0eWxlPVwibWFyZ2luLXRvcDogMHB4XCJcbiAgICAgICAgPlxuICAgICAgICA8L25neC1zbGlkZXI+XG4gICAgPC9kaXY+XG48L2Rpdj5cbjxkaXYgXG4gICAgKm5nRm9yPVwibGV0IGQgb2YgZGF0YVwiIFxuICAgIGNsYXNzPVwiZmllbGQtY2hlY2tib3hcIlxuICAgIHN0eWxlPVwicG9zaXRpb246IHJlbGF0aXZlO1wiXG4+XG4gICAgPHN2Z1xuICAgICAgICBbaWRdPVwiZ2V0SWQoKSArIGRbdmFsdWUgfHwgJ3ZhbHVlJ11cIlxuICAgICAgICB3aWR0aD1cIjBcIlxuICAgICAgICBoZWlnaHQ9XCIwXCJcbiAgICAgICAgc3R5bGU9XCJwb3NpdGlvbjogYWJzb2x1dGU7XCJcbiAgICA+XG4gICAgPC9zdmc+XG4gICAgPHAtY2hlY2tib3hcbiAgICAgICAgW2lucHV0SWRdPVwiZFtpbnB1dElkIHx8ICdpbnB1dElkJ10gfHwgbnVsbFwiXG4gICAgICAgIFtuYW1lXT1cImRbbmFtZSB8fCAnbmFtZSddIHx8IG51bGxcIlxuICAgICAgICBbdmFsdWVdPVwiZFt2YWx1ZSB8fCAndmFsdWUnXSB8fCBudWxsXCJcbiAgICAgICAgW2xhYmVsXT1cImRbbGFiZWwgfHwgJ2xhYmVsJ10gfHwgbnVsbFwiXG4gICAgICAgIFtkaXNhYmxlZF09XCJkWydkaXNhYmxlZCddIHx8IGZhbHNlXCJcbiAgICAgICAgW2JpbmFyeV09XCJkWydiaW5hcnknXSB8fCBmYWxzZVwiXG4gICAgICAgIFt0YWJpbmRleF09XCJkWyd0YWJpbmRleCddIHx8IG51bGxcIlxuICAgICAgICBbc3R5bGVdPVwiZFsnc3R5bGUnXSB8fCBzdHlsZSB8fCBudWxsXCJcbiAgICAgICAgW3N0eWxlQ2xhc3NdPVwiZFsnc3R5bGVDbGFzcyddIHx8IHN0eWxlQ2xhc3MgfHwgbnVsbFwiXG4gICAgICAgIFtsYWJlbFN0eWxlQ2xhc3NdPVwiZFsnbGFiZWxTdHlsZUNsYXNzJ10gfHwgbGFiZWxTdHlsZUNsYXNzIHx8IG51bGxcIlxuICAgICAgICBbY2hlY2tib3hJY29uXT1cImRbJ2NoZWNrYm94SWNvbiddIHx8ICdwaSBwaS1jaGVjaydcIlxuICAgICAgICBbcmVhZG9ubHldPVwiZFsncmVhZG9ubHknXSB8fCBmYWxzZVwiXG4gICAgICAgIFtyZXF1aXJlZF09XCJkWydyZXF1aXJlZCddIHx8IGZhbHNlXCJcbiAgICAgICAgW3RydWVWYWx1ZV09XCJkWyd0cnVlVmFsdWUnXSB8fCB0cnVlXCJcbiAgICAgICAgW2ZhbHNlVmFsdWVdPVwiZFsnZmFsc2VWYWx1ZSddIHx8IGZhbHNlXCJcbiAgICAgICAgKG5nTW9kZWxDaGFuZ2UpPVwidGhpcy5nZXRQcm92ZW5hbmNlKCkuaW50ZXJhY3Rpb24gPSAndXNlci1jaGFuZ2UnOyBzZWxlY3RlZENoYW5nZS5lbWl0KCRldmVudClcIlxuICAgICAgICBbbmdNb2RlbF09XCJzZWxlY3RlZFwiXG4gICAgICAgIChvbkJsdXIpPVwib25CbHVyXCJcbiAgICAgICAgKG9uQ2xpY2spPVwib25DbGlja1wiXG4gICAgICAgIChvbkNoYW5nZSk9XCJvbkNoYW5nZVwiXG4gICAgPlxuICAgIDwvcC1jaGVja2JveD5cbjwvZGl2PiJdfQ==